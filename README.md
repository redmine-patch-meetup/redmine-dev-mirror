# Redmineãƒ‘ãƒƒãƒä¼š

Redmineæœ¬ä½“ã®æ”¹å–„ã‚’ã§ãã‚‹äººã‚’å¢—ã‚„ã—ã€Redmineãƒ‘ãƒƒãƒä¼šã‚’ç¶™ç¶šçš„ã«è¡Œã£ã¦ã„ã‘ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã€2020å¹´7æœˆã‹ã‚‰åŸºæœ¬æ¯æœˆã‚ªãƒ³ãƒ©ã‚¤ãƒ³é–‹å‚¬ã—ã¦ã„ã¾ã™ã€‚

åŸºæœ¬ã¯è¤‡æ•°äººã®ãƒãƒ¼ãƒ ã«åˆ†ã‹ã‚Œã¦ã€ç›¸è«‡ã—ãªãŒã‚‰ãƒ‘ãƒƒãƒã‚’æ›¸ã„ã¦ã„ã¾ã™ã€‚  
(ä¸€äººã§ã‚‚OKã€ä»Šå¾Œå‚åŠ è€…ã‚’ä¸­å¿ƒã«ã‚„ã‚Šæ–¹ãŒå¤‰ã‚ã£ã¦ã„ãã‹ã‚‚)

## ã“ã®ãƒªãƒã‚¸ãƒˆãƒª

ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã€[Redmine](https://redmine.org/projects/redmine)ã®ãƒ•ã‚©ãƒ¼ã‚¯ãƒªãƒã‚¸ãƒˆãƒªã§ã™ã€‚  
ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã§Redmineã®ãƒã‚°ä¿®æ­£ã‚„æ©Ÿèƒ½æ”¹å–„ã‚’è¡Œã„ã€Redmineæœ¬ä½“ã«å–ã‚Šè¾¼ã‚“ã§ã‚‚ã‚‰ã†ã“ã¨ã§Redmineã‚’ã‚ˆã‚Šè‰¯ãã—ã¦ã„ã‘ã‚‹ã‚ˆã†æ´»å‹•ã—ã¦ã„ã¾ã™ã€‚

## Redmineãƒ‘ãƒƒãƒä¼šã«å‚åŠ ã—ãŸã„

Redmineã®æ”¹å–„ã«èˆˆå‘³ã‚ã‚‹æ–¹ã§ã‚ã‚Œã°ã©ãªãŸã§ã‚‚ã€‚  
ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã›ãšã«ç”»é¢ã®æ–‡è¨€å¤‰æ›´ã§ã‚‚ãƒ‘ãƒƒãƒã¯é€ã‚Œã¾ã™ã€‚  
ä¸€ç·’ã«ä»•æ§˜ã‚’è€ƒãˆã¦ã€æœ¬å®¶ã«ãƒã‚±ãƒƒãƒˆã‚’ä½œæˆã™ã‚‹ã ã‘ã§ã‚‚ã‚„ã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã™ã€‚ Rubyãƒ»Railsã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°çµŒé¨“ãŒã‚ã‚‹ã¨æ›´ã«å¹…ã¯åºƒãŒã‚Šã¾ã™ã€‚

åˆå‚åŠ ã®å ´åˆã€è¦‹å­¦ã‹ã‚‰ã§ã‚‚ãŠæ°—è»½ã«ã©ã†ã(^^

### 1. Connpassã§ã‚¤ãƒ™ãƒ³ãƒˆã‚’å…¬é–‹ã—ã¦ã„ã‚‹ã®ã§ã€å‚åŠ ç”³ã—è¾¼ã¿ã‚’ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼

https://redmine-patch.connpass.com/  

### 2. å‚åŠ ç™»éŒ²ã‚’ã—ãŸã‚‰ã€ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã®ã‚„ã‚Šã¨ã‚Šãƒ»å½“æ—¥ã®ä¼šå ´ã¨ã—ã¦åˆ©ç”¨ã—ã¦ã„ã‚‹Discordã«å‚åŠ ã—ã‚ˆã†ï¼  

ã‚¤ãƒ™ãƒ³ãƒˆã«å‚åŠ ç™»éŒ²ã‚’ã—ãŸæ–¹ã«ã®ã¿å‚åŠ ç”¨URLãŒç¢ºèªå¯èƒ½ã§ã™ã€‚  
å‚åŠ ã®ä¸Šã§ä¸å®‰ãªç‚¹ã€ã‚ã‹ã‚‰ãªã„ç‚¹ãŒã‚ã£ãŸã‚‰ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ£ãƒ³ãƒãƒ«ã§æ°—è»½ã«ç›¸è«‡ã—ã¦ãã ã•ã„ğŸ‘

### 3. ãƒãƒ¼ãƒ é–‹ç™ºã«å‚åŠ ã§ãã‚‹ç’°å¢ƒã‚’æ•´ãˆã‚ˆã†ï¼(ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ä»¥å¤–ã§ã®å‚åŠ ã®å ´åˆã¯ä¸è¦)  

ä¸»ã«é€šè©±ã«Discordã€è¤‡æ•°äººã§ã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã«Visual Studio Codeã®Live Shareæ‹¡å¼µã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚  
**VSCodeã®Live Shareã§ãƒ¢ãƒ–ãƒ—ãƒ­ã®ã‚ˆã†ã«å‚åŠ ã§ãã‚‹ãŸã‚ã€RedmineãŒå‹•ãé–‹ç™ºç’°å¢ƒãŒãªãã¦ã‚‚å‚åŠ ã§ãã¾ã™ã€‚**

* [Visual Studio Code](https://code.visualstudio.com/)ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
* Visual Studio Codeã‚’é–‹ã„ã¦ã€æ‹¡å¼µæ©Ÿèƒ½ [Live Share](https://marketplace.visualstudio.com/items?itemName=MS-vsliveshare.vsliveshare)ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
* (ãªã„äººã¯)Githubã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ

### 4. ã‚¤ãƒ™ãƒ³ãƒˆã®æ™‚é–“ã«ãªã£ãŸã‚‰Discordã‚’é–‹ã„ã¦ã€ãƒœã‚¤ã‚¹ãƒãƒ£ãƒ³ãƒãƒ«ã«å‚åŠ ã—ã‚ˆã†ï¼

(æ™‚é–“ã«ãªã£ãŸã‚‰ä»–ã®å‚åŠ è€…ã‚‚å‚åŠ ã—ã¦ã„ã‚‹ã¯ãš)

## VSCode Remote Containerã«ã‚ˆã‚‹Redmineã®é–‹ç™ºç’°å¢ƒã®ä½œã‚Šæ–¹ / æ©Ÿèƒ½

Redmineã®é–‹ç™ºç’°å¢ƒã‚’ä½œã‚‹ã‚„ã‚Šæ–¹ã®ã†ã¡ã®ä¸€ã¤ã§ã™ã€‚é–‹ç™ºç’°å¢ƒãŒã™ã§ã«ã‚ã‚‹äººã¯ã“ã®æ‰‹é †ã‚’ä½¿ã‚ãªãã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã€‚

### å‰ææ¡ä»¶

* Docker Desktopã‚’èµ·å‹•ã—ã¦ã„ã‚‹
* Visual Studio CodeãŒåˆ©ç”¨ã§ãã‚‹

### åˆ©ç”¨æ‰‹é †

* ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’æ‰‹å…ƒã«Clone

```bash session
$ git clone --config=core.autocrlf=input https://github.com/redmine-patch-meetup/redmine-dev-mirror.git
$ cd ./redmine-dev-mirror
```

* å¿…è¦ã«å¿œã˜ã¦.envã‚’æ›¸ãæ›ãˆã‚‹(portã®è¡çªãŒãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚‚å‹•ãã¾ã™)

```bash
# é–‹ç™ºä¸­ã®Redmineã« http://localhost:8000 ã§ã‚¢ã‚¯ã‚»ã‚¹å‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚8000ã‚’æ—¢ã«ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯å¤‰ãˆã‚‹
APP_PORT=8000
# Seleniumã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã¨ãã«åˆ©ç”¨ã™ã‚‹ãƒãƒ¼ãƒˆã€‚4444, 5900ã‚’æ—¢ã«ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯å¤‰ãˆã‚‹
SELENIUM_PORT_1=4444
SELENIUM_PORT_2=5900
# Redmineã‹ã‚‰é€ä¿¡ã—ãŸãƒ¡ãƒ¼ãƒ«ã‚’ http://localhost:1080 ã§ç¢ºèªå‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚1080ã‚’æ—¢ã«ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯å¤‰ãˆã‚‹
MAILCATCHER_PORT=1080
# mysqlã‚„sqlite3ã«å¤‰ãˆã¦ã‚‚è‰¯ã„ã€‚mysqlã®å ´åˆã€.devcontainer/docker-compose.ymlã®MySQLé–¢é€£ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã‚’å¤–ã™
RAILS_DB_ADAPTER=postgresql
```

* VScodeã«æ‹¡å¼µæ©Ÿèƒ½[Remote-Containers](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers)ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

* VScodeã§/your/path/redmine-dev-mirror ã‚’é–‹ã„ãŸçŠ¶æ…‹ã§ã€VSCodeã®ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆã‹ã‚‰Remote Containers: Rebuild and Reopen in Containerï¼ˆã‚‚ã—ãã¯å³ä¸‹ã«å‡ºã¦ãã‚‹ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®Reopen in Containerï¼‰ã‚’é¸æŠ => ãƒ“ãƒ«ãƒ‰ãŒå§‹ã¾ã‚‹ã¯ãš

<img width="1552" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2022-07-31 12 35 51" src="https://user-images.githubusercontent.com/14245262/182008960-c1bbbc91-6b0a-446c-b885-45d7fd444aca.png">

* VSCodeã®å·¦å´ã®ãƒãƒ¼ãŒèµ¤ããªã‚Šã€å·¦å´ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ„ãƒªãƒ¼ã‚‚è¡¨ç¤ºã•ã‚ŒãŸã‚‰ã‚³ãƒ³ãƒ†ãƒŠå†…ã«å…¥ã‚Œã¦ã„ã‚‹çŠ¶æ…‹

ç”»é¢ä¸‹ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«"Press any key"ã¨è¡¨ç¤ºã•ã‚Œã‚‹ãŸã‚ã€ã€Œã‚­ãƒ¼å…¥åŠ›ã‚’è¡Œã„(ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãŒé–‰ã˜ã‚‹)ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ãã€ã‹ ã€Œ"Press any key"ã‚’æ”¾ç½®ã—ãŸã¾ã¾ã‚¿ãƒ¼ãƒŸãƒŠãƒ«å³ä¸Šã®ãƒ—ãƒ©ã‚¹ã‚’æŠ¼ã™ã€ ã¨ã„ã†æµã‚Œã§ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

<img width="1552" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2022-07-31 12 37 54" src="https://user-images.githubusercontent.com/14245262/182008962-8e32682a-f3a6-438d-b220-6de172d79ee7.png">
â†“
<img width="1552" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2022-07-31 12 41 52" src="https://user-images.githubusercontent.com/14245262/182008964-d5179c64-07f6-4953-902c-bade758448d9.png">

* ç”»é¢ä¸‹ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«å†…ã§
```bash
$ rails s -b 0.0.0.0
```
* å°‘ã—å¾…ã¤ã¨ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ http://localhost:[.envã§æŒ‡å®šã—ãŸAPP_PORT] ã§Redmineã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚

<img width="1552" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2022-07-31 12 42 01" src="https://user-images.githubusercontent.com/14245262/182008965-77d731b6-4059-4dd2-87d9-87fce53e9d1d.png">

* ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
```bash
$ bundle exec rake test RAILS_ENV=test
```

### ãŠã¾ã‘

#### 1. VSCodeã®æ‹¡å¼µæ©Ÿèƒ½ã‚’å¢—ã‚„ã—ãŸã„

.devcontainer/devcontainer.jsonã®extensionsã«æ‹¡å¼µæ©Ÿèƒ½ã‚’è¿½åŠ ã—ã€VSCodeã®ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆã‹ã‚‰Rebuild and Reopen container

#### 2. Redmineã‹ã‚‰é€ä¿¡ã•ã‚Œã‚‹ãƒ¡ãƒ¼ãƒ«ã®å†…å®¹ã‚’ãƒã‚§ãƒƒã‚¯

http://localhost:[.envã§æŒ‡å®šã—ãŸMAILCATCHER_PORT] ã§ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ãƒ¡ãƒ¼ãƒ«ã‚­ãƒ£ãƒƒãƒãƒ£ãƒ¼ã‚’é–‹ã‘ã‚‹

#### 3. Ruby3.0ç³»ä»¥å¤–ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§å‹•ä½œæ¤œè¨¼ã‚„ãƒ†ã‚¹ãƒˆã‚’ã—ãŸã„

Dockerfile-for-redmine-dev-mirrorãƒ•ã‚¡ã‚¤ãƒ«ã® ``FROM mcr.microsoft.com/vscode/devcontainers/ruby:3` ã®3éƒ¨åˆ†ã‚’åˆ©ç”¨ã—ãŸã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æ›¸ãæ›ãˆã¦ã€VSCodeã®ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆã‹ã‚‰Rebuild and Reopen container

#### 4. test/systemã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹å ´åˆ

.devcontainer/docker-compose.ymlå†…ã®chrome:ã®å¡Šã®ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã‚’å¤–ã—ã€VSCodeã®ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆã‹ã‚‰Rebuild and Reopen container

 selenium/standalone-chrome-debugã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰æŒã£ã¦ããŸchromeã‚’å‹•ã‹ã™ãŸã‚ã«Capybaraå‘¨ã‚Šã§ä¸‹ã®ã‚ˆã†ã«è¨­å®šã‚’è¿½åŠ ã™ã‚‹ã€‚
 app == docker-composeã§railsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå‹•ã„ã¦ã„ã‚‹ã¨ã“ã‚ã®ã‚µãƒ¼ãƒ“ã‚¹å
 chrome:4444 == docker-compose selenium/standalone-chrome-debugã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚µãƒ¼ãƒ“ã‚¹å + port

```diff
diff --git a/test/application_system_test_case.rb b/test/application_system_test_case.rb
index 1a1e0cb4a..fedbe7d15 100644
--- a/test/application_system_test_case.rb
+++ b/test/application_system_test_case.rb
@@ -43,13 +43,17 @@ class ApplicationSystemTestCase < ActionDispatch::SystemTestCase
                     }
                   }
                 )
-
+  options[:browser] = :remote
+  Capybara.server_host = 'app'
+  Capybara.server_port = <.envã®APP_PORT(ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ8000)ã«å…¥ã‚ŒãŸå€¤ã«æ›¸ãæ›ãˆã‚‹>
   driven_by(
     :selenium, using: :chrome, screen_size: [1024, 900],
     options: options
   )
 
   setup do
+    Capybara.app_host = "http://#{Capybara.server_host}:#{Capybara.server_port}"
     # Allow defining a custom app host (useful when using a remote Selenium hub)
     if ENV['CAPYBARA_APP_HOST']
       Capybara.configure do |config|

```

```
 bundle exec rake test TEST=test/system RAILS_ENV=test
```

ãã®ã¨ããƒ›ã‚¹ãƒˆå´ã§
```
open vnc://localhost:5900
```
ã‚’å®Ÿè¡Œã™ã‚‹ã¨å®Ÿéš›ã«å‹•ã„ã¦ã„ã‚‹Chromeã®ç”»é¢ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚ (ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¦æ±‚ã•ã‚ŒãŸã‚‰ `secret` ã¨å…¥ã‚Œã‚‹)
